{"version":3,"sources":["node_modules/browser-pack/_prelude.js","src/dust.js","src/gui.js","src/main.js","src/utils/webgl-detect.js","src/vendor/cellauto.js","src/worlds.js"],"names":["e","t","n","r","s","o","u","a","require","i","f","Error","code","l","exports","call","length","1","module","_cellauto","_worlds","FrameCounter","Dust","container","initFinishedCallback","_this","this","_classCallCheck","worldNames","Object","keys","Worlds","worldOptions","name","Math","random","app","PIXI","Application","antialias","transparent","resolution","appendChild","view","ticker","add","delta","OnUpdate","framecounter","stop","loader","load","res","loadedResources","Setup","start","world","width","height","frameFrequency","recommendedFrameFrequency","renderer","resize","style","cssText","border","backgroundColor","textureCanvas","document","createElement","textureCtx","getContext","baseTexture","BaseTexture","fromCanvas","sprite","Sprite","Texture","Rectangle","x","y","anchor","set","filter","Filter","fragShader","data","filters","stage","removeChildren","addChild","UpdateTexture","IncrementFrame","uniforms","time","step","render","index","ctx","fillStyle","fillRect","pix","createImageData","paletteIndex","grid","getColor","colorRGBA","palette","ex","console","error","putImageData","update","frameLimit","arguments","undefined","frameCount","passedFrames","GUI","dust","dat","warn","gui","min","max","listen","getOwnPropertyNames","onChange","_webglDetect","_dust","_gui","getElementById","Detector","HasWebGL","Init","log","innerHTML","GetErrorHTML","classList","window","WebGLRenderingContext","canvas","names","context","getParameter","message","CellAutoCell","locX","locY","delays","CAWorld","options","wrap","TOPLEFT","TOP","TOPRIGHT","LEFT","RIGHT","BOTTOMLEFT","BOTTOM","BOTTOMRIGHT","randomGenerator","neighborhood","hexTiles","reset","fillNeighbors","cell","process","steps","action","splice","NEIGHBORLOCS","diffX","diffY","flatTopped","neighbors","neighborX","neighborY","initialize","arrayTypeDist","sort","b","distribution","totalDist","cellTypes","registerCellType","cellOptions","init","key","_typeof","JSON","parse","stringify","prototype","create","constructor","cellType","countSurroundingCellsWithValue","value","surrounding","delay","numSteps","fn","push","getSurroundingCellsAverageValue","summed","initializeFromGrid","values","initGrid","gridValue","createGridFromValues","defaultValue","newGrid","hasProperty","CellAuto","World","Cell","define","amd","Life","alive","wasAlive","Lava","colors","v","sin","PI","floor","droplet","prev","avg","next","Mazecetric","threshold","CyclicRainbows","state","changing","newState","CavesWithWater","open","wasOpen","clearRect","water","amt","ceil","isSolid","lighted","Rain","Splashes","Wolfram","choice","seedList","neighborOnes","item","seed","minX","maxX","minY","maxY","BelousovZhabotinsky","kernel","reverse","gray","healthy","infected","ill","sumStates","neighbor","numStates"],"mappings":"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,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,IAC3B,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,IAC3B,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,IAC3B,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,IAC3B,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,IAC3B,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,IAC3B,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,IAC3B,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,MAE9B,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,IAAK,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,IAAK,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,IAAK,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,MACnG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,IAAK,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,IAAK,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,IAAK,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,MACnG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,IAAK,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,IAAK,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,IAAK,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,MACnG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,IAAK,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,IAAK,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,IAAK,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,MACnG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,IAAK,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,IAAK,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,IAAK,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,MACnG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,IAAK,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,IAAK,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,IAAK,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,MACnG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,IAAK,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,IAAK,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,IAAK,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,MACnG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,IAAK,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,IAAK,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,IAAK,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,MACnG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,IAAK,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,IAAK,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,IAAK,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,MACnG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,IAAK,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,IAAK,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,IAAK,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,MACnG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,IAAK,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,IAAK,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,IAAK,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,MACnG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,IAAK,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,IAAK,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,IAAK,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,MACnG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,IAAK,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,IAAK,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,IAAK,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,MACnG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,IAAK,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,IAAK,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,IAAK,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,MACnG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,IAAK,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,IAAK,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,IAAK,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,MACnG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,IAAK,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,IAAK,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,IAAK,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,MACnG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,IAAK,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,IAAK,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,IAAK,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,MACnG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,IAAK,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,IAAK,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,IAAK,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,MACnG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,IAAK,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,IAAK,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,IAAK,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,MACnG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,IAAK,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,IAAK,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,IAAK,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,MACnG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,IAAK,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,IAAK,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,IAAK,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,MACnG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,IAAK,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,IAAK,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,IAAK,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,MACnG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,IAAK,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,IAAK,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,IAAK,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,MACnG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,IAAK,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,IAAK,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,IAAK,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,MACnG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,IAAK,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,IAAK,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,IAAK,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,MACnG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,IAAK,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,IAAK,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,IAAK,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,MACnG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,IAAK,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,IAAK,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,IAAK,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,MACnG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,IAAK,EAAG,EAAG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","file":"dust.min.js","sourcesContent":["(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})","import * as CellAuto from \"./vendor/cellauto.js\";\nimport { Worlds } from \"./worlds.js\";\n\nexport class Dust {\n    constructor(container, initFinishedCallback) {\n        this.container = container;\n\n        var worldNames = Object.keys(Worlds);\n        this.worldOptions = {\n            name: worldNames[worldNames.length * Math.random() << 0], // Random startup world\n            //width: 128, // Can force a width/height here\n            //height: 128\n        }\n\n        // Create the app and put its canvas into `container`\n        this.app = new PIXI.Application(\n            {\n                antialias: false, \n                transparent: false, \n                resolution: 1\n            }\n        );\n        this.container.appendChild(this.app.view);\n\n        // Start the update loop\n        this.app.ticker.add((delta) => {\n            this.OnUpdate(delta);\n        });\n\n        this.framecounter = new FrameCounter(1, null);\n\n        // Stop application and wait for setup to finish\n        this.app.stop();\n\n        // Load resources needed for the program to run\n        PIXI.loader\n            .add('fragShader', '../resources/dust.frag')\n            .load((loader, res) => {\n                // Loading has finished\n                this.loadedResources = res;\n                this.Setup();\n                this.app.start();\n                initFinishedCallback();\n            });\n    }\n\n    /**\n     * Reusable method for setting up the simulation from `this.worldOptions`.\n     * Also works as a reset function if you call this without changing\n     * `this.worldOptions.name` beforehand.\n     */\n    Setup() {\n\n        // Create the world from the string\n        this.world = Worlds[this.worldOptions.name].call(this, this.worldOptions.width, this.worldOptions.height);\n        this.framecounter.frameFrequency = this.world.recommendedFrameFrequency || 1;\n\n        this.app.renderer.resize(this.world.width, this.world.height);\n\n        // Remove canvas filtering through css\n        this.app.renderer.view.style.cssText = ` \n            image-rendering: optimizeSpeed; \n            image-rendering: -moz-crisp-edges; \n            image-rendering: -webkit-optimize-contrast; \n            image-rendering: optimize-contrast;\n            image-rendering: -o-crisp-edges; \n            image-rendering: pixelated; \n            -ms-interpolation-mode: nearest-neighbor; \n        `;\n        this.app.renderer.view.style.border = \"1px dashed green\";\n        this.app.renderer.view.style.width = \"100%\";\n        this.app.renderer.view.style.height = \"100%\";\n        this.app.renderer.backgroundColor = 0xffffff;\n\n        // Create a sprite from a blank canvas\n        this.textureCanvas = document.createElement('canvas');\n        this.textureCanvas.width = this.world.width;\n        this.textureCanvas.height = this.world.height;\n        this.textureCtx = this.textureCanvas.getContext('2d'); // Used later to update texture\n\n        this.baseTexture = new PIXI.BaseTexture.fromCanvas(this.textureCanvas);\n        this.sprite = new PIXI.Sprite(\n            new PIXI.Texture(this.baseTexture, new PIXI.Rectangle(0, 0, this.world.width, this.world.height))\n        );\n\n        // Center the sprite\n        this.sprite.x = this.world.width / 2;\n        this.sprite.y = this.world.height / 2;\n        this.sprite.anchor.set(0.5);\n\n        // Create the shader for the sprite\n        this.filter = new PIXI.Filter(null, this.loadedResources.fragShader.data);\n        this.sprite.filters = [this.filter];\n\n        this.app.stage.removeChildren(); // Remove any attached children (for case where changing presets)\n        this.app.stage.addChild(this.sprite);\n\n        // Update the texture from the initial state of the world\n        this.UpdateTexture();\n    }\n\n    /**\n     * Called every frame. Continues indefinitely after being called once.\n     */\n    OnUpdate(delta) {\n        var noskip = this.framecounter.IncrementFrame();\n        if(noskip) {\n            this.filter.uniforms.time += delta;\n            this.world.step();\n            this.UpdateTexture();\n            this.app.render();\n        }\n\n    }\n\n    /**\n     * Updates the texture representing the world.\n     * Writes cell colors to the texture canvas and updates `baseTexture` from it,\n     * which makes Pixi update the sprite.\n     */\n    UpdateTexture() {\n        \n        var index = 0;\n        var ctx = this.textureCtx;\t\t\n        ctx.fillStyle = \"black\";\n        ctx.fillRect(0, 0, this.textureCanvas.width, this.textureCanvas.height);\n        var pix = ctx.createImageData(this.textureCanvas.width, this.textureCanvas.height);\t\t\n        for (var y = 0; y < this.textureCanvas.height; y++) {\t\t\t\n            for (var x = 0; x < this.textureCanvas.width; x++) {\n                // Swap buffers if used\n                //if(this.world.grid[y][x].newState != null)\n                //    this.world.grid[y][x].state = this.world.grid[y][x].newState;\n                var paletteIndex = this.world.grid[y][x].getColor();\n                try {\t\t\t\t\n                    var colorRGBA = this.world.palette[paletteIndex];\t\n                    pix.data[index++] = colorRGBA[0];\t\t\t\t\n                    pix.data[index++] = colorRGBA[1];\t\t\t\t\n                    pix.data[index++] = colorRGBA[2];\t\t\t\t\n                    pix.data[index++] = colorRGBA[3];\t\n                } catch (ex) {\n                    console.error(paletteIndex);\n                    throw new Error(ex);\n                }\t\n            }\t\t\n        } \t\t\n        ctx.putImageData(pix, 0, 0);\n\n        // Tell Pixi to update the texture referenced by this ctx.\n        this.baseTexture.update();\n\n    }\n\n}\n\n/**\n * Convenience class for restricting the refresh rate of the simulation.\n */\nclass FrameCounter {\n    constructor(frameFrequency, frameLimit = null) {\n        // The number of frames ingested\n        this.frameCount = 0;\n\n        // The number of frames allowed to run\n        this.passedFrames = 0;\n\n        // Frame will run every `frameFrequency` frames that pass\n        this.frameFrequency = frameFrequency;\n\n        // If set, class will stop allowing frames after `frameLimit` \n        // passedFrames have been allowed.\n        this.frameLimit = frameLimit;\n    }\n\n    /**\n     * Returns true once every `frameFrequency` times it is called.\n     */\n    IncrementFrame(){\n        this.frameCount += 1;\n        if(this.frameCount % this.frameFrequency == 0) {\n            // If we've reached the frame limit\n            if(this.frameLimit != null && this.passedFrames >= this.frameLimit)\n                return false;\n\n            this.frameCount = 0;\n            this.passedFrames += 1;\n            return true;\n        }\n        return false;\n    }\n}","import { Worlds } from \"./worlds.js\";\n\nexport class GUI {\n\n    /**\n     * Creates and attaches a GUI to the page if DAT.GUI is included.\n     */\n    static Init(dust){\n        if(typeof(dat) === \"undefined\"){\n            console.warn(\"No DAT.GUI instance found. Import on this page to use!\");\n            return;\n        }\n\n        var gui = new dat.GUI();\n\n        gui.add(dust.framecounter, 'frameFrequency').min(1).max(30).step(1).listen();\n\n        gui.add(dust.worldOptions, 'name', Object.getOwnPropertyNames(Worlds)).onChange(() => {\n            dust.Setup();\n        }).name(\"Preset\");\n\n        gui.add(dust, \"Setup\").name(\"Reset\");\n    }\n\n}","import { Detector } from \"./utils/webgl-detect.js\";\nimport { Dust } from \"./dust.js\";\nimport { GUI } from \"./gui.js\";\n\nlet container = document.getElementById(\"dust-container\");\n\nif ( !Detector.HasWebGL() ) {\n    //exit(\"WebGL is not supported on this browser.\");\n    console.log(\"WebGL is not supported on this browser.\");\n    container.innerHTML = Detector.GetErrorHTML();\n    container.classList.add(\"no-webgl\");\n}\nelse {\n    let dust = new Dust(container, () => {\n        // Dust is now fully loaded\n        GUI.Init(dust);\n    });\n}","class Detector {\n\n    //http://stackoverflow.com/questions/11871077/proper-way-to-detect-webgl-support\n    static HasWebGL() {\n        if (!!window.WebGLRenderingContext) {\n            var canvas = document.createElement(\"canvas\"),\n                    names = [\"webgl\", \"experimental-webgl\", \"moz-webgl\", \"webkit-3d\"],\n                context = false;\n\n            for(var i=0;i<4;i++) {\n                try {\n                    context = canvas.getContext(names[i]);\n                    if (context && typeof context.getParameter == \"function\") {\n                        // WebGL is enabled\n                        return true;\n                    }\n                } catch(e) {}\n            }\n\n            // WebGL is supported, but disabled\n            return false;\n        }\n        // WebGL not supported\n        return false;\n    }\n\n    static GetErrorHTML(message = null){\n        if(message == null){\n            message = `Your graphics card does not seem to support \n                        <a href=\"http://khronos.org/webgl/wiki/Getting_a_WebGL_Implementation\">WebGL</a>. <br>\n                        Find out how to get it <a href=\"http://get.webgl.org/\">here</a>.`;\n        }\n        return `\n        <div class=\"no-webgl-support\">\n        <p style=\"text-align: center;\">${message}</p>\n        </div>\n        `\n    }\n\n}\n\nexport { Detector };","function CellAutoCell(locX, locY) {\n\tthis.x = locX;\n\tthis.y = locY;\n\n\tthis.delays = [];\n}\n\nCellAutoCell.prototype.process = function(neighbors) {\n\treturn;\n};\nCellAutoCell.prototype.countSurroundingCellsWithValue = function(neighbors, value) {\n\tvar surrounding = 0;\n\tfor (var i = 0; i < neighbors.length; i++) {\n\t\tif (neighbors[i] !== null && neighbors[i][value]) {\n\t\t\tsurrounding++;\n\t\t}\n\t}\n\treturn surrounding;\n};\nCellAutoCell.prototype.delay = function(numSteps, fn) {\n\tthis.delays.push({ steps: numSteps, action: fn });\n};\n\nCellAutoCell.prototype.reset = function(neighbors) {\n\treturn;\n};\n\nCellAutoCell.prototype.getSurroundingCellsAverageValue = function(neighbors, value) {\n\tvar summed = 0.0;\n\tfor (var i = 0; i < neighbors.length; i++) {\n\t\tif (neighbors[i] !== null && (neighbors[i][value] || neighbors[i][value] === 0)) {\n\t\t\tsummed += neighbors[i][value];\n\t\t}\n\t}\n\treturn summed / neighbors.length;//cnt;\n};\nfunction CAWorld(options) {\n\n\tthis.width = 24;\n\tthis.height = 24;\n\tthis.options = options;\n\n\tthis.wrap = false;\n\n\tthis.TOPLEFT        = { index: 0, x: -1, y: -1 };\n\tthis.TOP            = { index: 1, x:  0, y: -1 };\n\tthis.TOPRIGHT       = { index: 2, x:  1, y: -1 };\n\tthis.LEFT           = { index: 3, x: -1, y:  0 };\n\tthis.RIGHT          = { index: 4, x:  1, y:  0 };\n\tthis.BOTTOMLEFT     = { index: 5, x: -1, y:  1 };\n\tthis.BOTTOM         = { index: 6, x:  0, y:  1 };\n\tthis.BOTTOMRIGHT    = { index: 7, x:  1, y:  1 };\n\t\n\tthis.randomGenerator = Math.random;\n\n\t// square tiles by default, eight sides\n\tvar neighborhood = [null, null, null, null, null, null, null, null];\n\n\tif (this.options.hexTiles) {\n\t\t// six sides\n\t\tneighborhood = [null, null, null, null, null, null];\n\t}\n\tthis.step = function() {\n\t\tvar y, x;\n\t\tfor (y=0; y<this.height; y++) {\n\t\t\tfor (x=0; x<this.width; x++) {\n\t\t\t\tthis.grid[y][x].reset();\n\t\t\t}\n\t\t}\n\n\t\t// bottom up, left to right processing\n\t\tfor (y=this.height-1; y>=0; y--) {\n\t\t\tfor (x=this.width-1; x>=0; x--) {\n\t\t\t\tthis.fillNeighbors(neighborhood, x, y);\n\t\t\t\tvar cell = this.grid[y][x];\n\t\t\t\tcell.process(neighborhood);\n\n\t\t\t\t// perform any delays\n\t\t\t\tfor (var i=0; i<cell.delays.length; i++) {\n\t\t\t\t\tcell.delays[i].steps--;\n\t\t\t\t\tif (cell.delays[i].steps <= 0) {\n\t\t\t\t\t\t// perform action and remove delay\n\t\t\t\t\t\tcell.delays[i].action(cell);\n\t\t\t\t\t\tcell.delays.splice(i, 1);\n\t\t\t\t\t\ti--;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t};\n\n\t//var NEIGHBORLOCS = [{x:-1, y:-1}, {x:0, y:-1}, {x:1, y:-1}, {x:-1, y:0}, {x:1, y:0},{x:-1, y:1}, {x:0, y:1}, {x:1, y:1}];\n\t// square tiles by default\n\tvar NEIGHBORLOCS = [\n\t\t{ diffX : function() { return -1; }, diffY: function() { return -1; }},  // top left\n\t\t{ diffX : function() { return 0; }, diffY: function() { return -1; }},  // top\n\t\t{ diffX : function() { return 1; }, diffY: function() { return -1; }},  // top right\n\t\t{ diffX : function() { return -1; }, diffY: function() { return 0; }},  // left\n\t\t{ diffX : function() { return 1; }, diffY: function() { return 0; }},  // right\n\t\t{ diffX : function() { return -1; }, diffY: function() { return 1; }},  // bottom left\n\t\t{ diffX : function() { return 0; }, diffY: function() { return 1; }},  // bottom\n\t\t{ diffX : function() { return 1; }, diffY: function() { return 1; }}  // bottom right\n\t];\n\tif (this.options.hexTiles) {\n\t\tif (this.options.flatTopped) {\n\t\t\t// flat topped hex map,  function requires column to be passed\n\t\t\tNEIGHBORLOCS = [\n\t\t\t\t{ diffX : function() { return -1; }, diffY: function(x) { return x%2 ? -1 : 0; }},  // top left\n\t\t\t\t{ diffX : function() { return 0; }, diffY: function() { return -1; }},  // top\n\t\t\t\t{ diffX : function() { return 1; }, diffY: function(x) { return x%2 ? -1 : 0; }},  // top right\n\t\t\t\t{ diffX : function() { return 1; }, diffY: function(x) { return x%2 ? 0 : 1; }},  // bottom right\n\t\t\t\t{ diffX : function() { return 0; }, diffY: function() { return 1; }},  // bottom\n\t\t\t\t{ diffX : function() { return -1; }, diffY: function(x) { return x%2 ? 0 : 1; }}  // bottom left\n\t\t\t];\n\t\t}\n\t\telse {\n\t\t\t// pointy topped hex map, function requires row to be passed\n\t\t\tNEIGHBORLOCS = [\n\t\t\t\t{ diffX : function(x, y) { return y%2 ? 0 : -1; }, diffY: function() { return -1; }},  // top left\n\t\t\t\t{ diffX : function(x, y) { return y%2 ? 1 : 0; }, diffY: function() { return -1; }},  // top right\n\t\t\t\t{ diffX : function() { return -1; }, diffY: function() { return 0; }},  // left\n\t\t\t\t{ diffX : function() { return 1; }, diffY: function() { return 0; }},  // right\n\t\t\t\t{ diffX : function(x, y) { return y%2 ? 0 : -1; }, diffY: function() { return 1; }},  // bottom left\n\t\t\t\t{ diffX : function(x, y) { return y%2 ? 1 : 0; }, diffY: function() { return 1; }}  // bottom right\n\t\t\t];\n\t\t}\n\n\t}\n\tthis.fillNeighbors = function(neighbors, x, y) {\n\t\tfor (var i=0; i<NEIGHBORLOCS.length; i++) {\n\t\t\tvar neighborX = x + NEIGHBORLOCS[i].diffX(x, y);\n\t\t\tvar neighborY = y + NEIGHBORLOCS[i].diffY(x, y);\n\t\t\tif (this.wrap) {\n\t\t\t\t// TODO: hex map support for wrapping\n\t\t\t\tneighborX = (neighborX + this.width) % this.width;\n\t\t\t\tneighborY = (neighborY + this.height) % this.height;\n\t\t\t}\n\t\t\tif (!this.wrap && (neighborX < 0 || neighborY < 0 || neighborX >= this.width || neighborY >= this.height)) {\n\t\t\t\tneighbors[i] = null;\n\t\t\t}\n\t\t\telse {\n\t\t\t\tneighbors[i] = this.grid[neighborY][neighborX];\n\t\t\t}\n\t\t}\n\t};\n\n\tthis.initialize = function(arrayTypeDist) {\n\n\t\t// sort the cell types by distribution\n\t\tarrayTypeDist.sort(function(a, b) {\n\t\t\treturn a.distribution > b.distribution ? 1 : -1;\n\t\t});\n\n\t\tvar totalDist = 0;\n\t\t// add all distributions together\n\t\tfor (var i=0; i<arrayTypeDist.length; i++) {\n\t\t\ttotalDist += arrayTypeDist[i].distribution;\n\t\t\tarrayTypeDist[i].distribution = totalDist;\n\t\t}\n\n\t\tthis.grid = [];\n\t\tfor (var y=0; y<this.height; y++) {\n\t\t\tthis.grid[y] = [];\n\t\t\tfor (var x=0; x<this.width; x++) {\n\t\t\t\tvar random = this.randomGenerator() * 100;\n\n\t\t\t\tfor (i=0; i<arrayTypeDist.length; i++) {\n\t\t\t\t\tif (random <= arrayTypeDist[i].distribution) {\n\t\t\t\t\t\tthis.grid[y][x] = new this.cellTypes[arrayTypeDist[i].name](x, y);\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t};\n\n\tthis.cellTypes = {};\n\tthis.registerCellType = function(name, cellOptions, init) {\n\t\tthis.cellTypes[name] = function(x, y) {\n\t\t\tCellAutoCell.call(this, x, y);\n\n\t\t\tif (init) {\n\t\t\t\tinit.call(this, x, y);\n\t\t\t}\n\n\t\t\tif (cellOptions) {\n\t\t\t\tfor (var key in cellOptions) {\n\t\t\t\t\tif (typeof cellOptions[key] !== 'function') {\n\t\t\t\t\t\t// properties get instance\n\t\t\t\t\t\tif (typeof cellOptions[key] === 'object') {\n\t\t\t\t\t\t\t// objects must be cloned\n\t\t\t\t\t\t\tthis[key] = JSON.parse(JSON.stringify(cellOptions[key]));\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse {\n\t\t\t\t\t\t\t// primitive\n\t\t\t\t\t\t\tthis[key] = cellOptions[key];\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t\tthis.cellTypes[name].prototype = Object.create(CellAutoCell.prototype);\n\t\tthis.cellTypes[name].prototype.constructor = this.cellTypes[name];\n\t\tthis.cellTypes[name].prototype.cellType = name;\n\n\t\tif (cellOptions) {\n\t\t\tfor (var key in cellOptions) {\n\t\t\t\tif (typeof cellOptions[key] === 'function') {\n\t\t\t\t\t// functions get prototype\n\t\t\t\t\tthis.cellTypes[name].prototype[key] = cellOptions[key];\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t};\n\n\t// apply options\n\tif (options) {\n\t\tfor (var key in options) {\n\t\t\tthis[key] = options[key];\n\t\t}\n\t}\n\n}\n\nCAWorld.prototype.initializeFromGrid  = function(values, initGrid) {\n\n\tthis.grid = [];\n\tfor (var y=0; y<this.height; y++) {\n\t\tthis.grid[y] = [];\n\t\tfor (var x=0; x<this.width; x++) {\n\t\t\tfor (var i=0; i<values.length; i++) {\n\t\t\t\tif (values[i].gridValue === initGrid[y][x]) {\n\t\t\t\t\tthis.grid[y][x] = new this.cellTypes[values[i].name](x, y);\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n};\n\nCAWorld.prototype.createGridFromValues = function(values, defaultValue) {\n\tvar newGrid = [];\n\n\tfor (var y=0; y<this.height; y++) {\n\t\tnewGrid[y] = [];\n\t\tfor (var x = 0; x < this.width; x++) {\n\t\t\tnewGrid[y][x] = defaultValue;\n\t\t\tvar cell = this.grid[y][x];\n\t\t\tfor (var i=0; i<values.length; i++) {\n\t\t\t\tif (cell.cellType == values[i].cellType && cell[values[i].hasProperty]) {\n\t\t\t\t\tnewGrid[y][x] = values[i].value;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\treturn newGrid;\n};\n\n;(function() {\n  var CellAuto = {\n    World: CAWorld,\n    Cell: CellAutoCell\n  };\n\n  if (typeof define === 'function' && define.amd) {\n    define('CellAuto', function () {\n      return CellAuto;\n    });\n  } else if (typeof module !== 'undefined' && module.exports) {\n    module.exports = CellAuto;\n  } else {\n    window.CellAuto = CellAuto;\n  }\n})();","import * as CellAuto from \"./vendor/cellauto.js\";\n\nexport var Worlds = {\n\n    /**\n     * Conway's Game of Life.\n     * \n     * From https://sanojian.github.io/cellauto\n     */\n    Life: function(width = 96, height = 96) {\n        var world = new CellAuto.World({\n            width: width,\n            height: height\n        });\n\n        world.palette = [\n            [68, 36, 52, 255],\n            [255, 255, 255, 255]\n        ];\n\n        world.registerCellType('living', {\n            getColor: function () {\n                return this.alive ? 0 : 1;\n            },\n            process: function (neighbors) {\n                var surrounding = this.countSurroundingCellsWithValue(neighbors, 'wasAlive');\n                this.alive = surrounding === 3 || surrounding === 2 && this.alive;\n            },\n            reset: function () {\n                this.wasAlive = this.alive;\n            }\n        }, function () {\n            // Init\n            this.alive = Math.random() > 0.5;\n        });\n\n        world.initialize([\n            { name: 'living', distribution: 100 }\n        ]);\n\n        return world;\n    },\n\n    /**\n     * CA that looks like lava.\n     * \n     * From https://sanojian.github.io/cellauto\n     */\n    Lava: function (width = 128, height = 128) {\n        // thanks to TheLastBanana on TIGSource\n\n        var world = new CellAuto.World({\n            width: width,\n            height: height,\n            wrap: true\n        });\n\n        world.palette = [\n            [34,10,21,255], [68,17,26,255], [123,16,16,255],\n            [190,45,16,255], [244,102,20,255], [254,212,97,255]\n        ];\n\n        var colors = [];\n        var index = 0;\n        for (; index < 18; ++index) { colors[index] = 1; }\n        for (; index < 22; ++index) { colors[index] = 0; }\n        for (; index < 25; ++index) { colors[index] = 1; }\n        for (; index < 27; ++index) { colors[index] = 2; }\n        for (; index < 29; ++index) { colors[index] = 3; }\n        for (; index < 32; ++index) { colors[index] = 2; }\n        for (; index < 35; ++index) { colors[index] = 0; }\n        for (; index < 36; ++index) { colors[index] = 2; }\n        for (; index < 38; ++index) { colors[index] = 4; }\n        for (; index < 42; ++index) { colors[index] = 5; }\n        for (; index < 44; ++index) { colors[index] = 4; }\n        for (; index < 46; ++index) { colors[index] = 2; }\n        for (; index < 56; ++index) { colors[index] = 1; }\n        for (; index < 64; ++index) { colors[index] = 0; }\n\n        world.registerCellType('lava', {\n            getColor: function () {\n                var v = this.value + 0.5\n                    + Math.sin(this.x / world.width * Math.PI) * 0.04\n                    + Math.sin(this.y / world.height * Math.PI) * 0.04\n                    - 0.05;\n                v = Math.min(1.0, Math.max(0.0, v));\n\n                return colors[Math.floor(colors.length * v)];\n            },\n            process: function (neighbors) {\n                if(this.droplet === true) {\n                    for (var i = 0; i < neighbors.length; i++) {\n                        if (neighbors[i] !== null && neighbors[i].value) {\n                            neighbors[i].value = 0.5 *this.value;\n                            neighbors[i].prev = 0.5 *this.prev;\n                        }\n                    }\n                    this.droplet = false;\n                    return true;\n                }\n                var avg = this.getSurroundingCellsAverageValue(neighbors, 'value');\n                this.next = 0.998 * (2 * avg - this.prev);\n\n                return true;\n            },\n            reset: function () {\n                if(Math.random() > 0.99993) {\n                    this.value = -0.25 + 0.3*Math.random();\n                    this.prev = this.value;\n                    this.droplet = true;\n                }\n                else {\n                    this.prev = this.value;\n                    this.value = this.next;\n                }\n                this.value = Math.min(0.5, Math.max(-0.5, this.value));\n                return true;\n            }\n        }, function () {\n            //init\n            this.value = 0.0;\n            this.prev = this.value;\n            this.next = this.value;\n        });\n\n        world.initialize([\n            { name: 'lava', distribution: 100 }\n        ]);\n\n        return world;\n\n    },\n\n    /**\n     * Generates a maze-like structure.\n     * Based on rule B3/S1234 (Mazecetric).\n     */\n    Mazecetric: function(width = 96, height = 96) {\n        var world = new CellAuto.World({\n            width: width,\n            height: height\n        });\n        world.recommendedFrameFrequency = 5;\n\n        world.palette = [\n            [68, 36, 52, 255],\n            [255, 255, 255, 255]\n        ];\n\n        var threshold = (Math.random() * 5) / 10;\n\n        world.registerCellType('living', {\n            getColor: function () {\n                return this.alive ? 0 : 1;\n            },\n            process: function (neighbors) {\n                var surrounding = this.countSurroundingCellsWithValue(neighbors, 'wasAlive');\n                this.alive = surrounding === 3 || (surrounding >= 1 && surrounding <= 4 && this.alive);\n            },\n            reset: function () {\n                this.wasAlive = this.alive;\n            }\n        }, function () {\n            // Init\n            this.alive = Math.random() < threshold;\n        });\n\n        world.initialize([\n            { name: 'living', distribution: 100 }\n        ]);\n\n        return world;\n    },\n\n    /**\n     * Cyclic rainbow automata.\n     * \n     * From https://sanojian.github.io/cellauto\n     */\n    CyclicRainbows: function(width = 128, height = 128) {\n        var world = new CellAuto.World({\n            width: width,\n            height: height\n        });\n\n        world.recommendedFrameFrequency = 1;\n\n        world.palette = [\n            [255,0,0,1 * 255], [255,96,0,1 * 255], [255,191,0,1 * 255], [223,255,0,1 * 255],\n            [128,255,0,1 * 255], [32,255,0,1 * 255], [0,255,64,1 * 255], [0,255,159,1 * 255],\n            [0,255,255,1 * 255], [0,159,255,1 * 255], [0,64,255,1 * 255], [32,0,255,1 * 255],\n            [127,0,255,1 * 255], [223,0,255,1 * 255], [255,0,191,1 * 255], [255,0,96,1 * 255]\n        ];\n\n        world.registerCellType('cyclic', {\n            getColor: function () {\n                return this.state;\n            },\n            process: function (neighbors) {\n                var next = (this.state + Math.floor(Math.random()*2)) % 16;\n\n                var changing = false;\n                for (var i = 0; i < neighbors.length; i++) {\n                    if (neighbors[i] !== null) {\n                        changing = changing || neighbors[i].state === next;\n                    }\n                }\n                if (changing) this.state = next;\n                return true;\n            },\n            reset: function () {\n                this.state = this.newState;\n            }\n        }, function () {\n            //init\n            this.newState = Math.floor(Math.random() * 16);\n        });\n\n        world.initialize([\n            { name: 'cyclic', distribution: 100 }\n        ]);\n\n        return world;\n    },\n\n    /**\n     * Simulates caves and water movement.\n     * \n     * From https://sanojian.github.io/cellauto\n     */\n    CavesWithWater: function(width = 128, height = 128) {\n        // FIRST CREATE CAVES\n        var world = new CellAuto.World({\n            width: width,\n            height: height\n        });\n\n        world.registerCellType('wall', {\n            process: function (neighbors) {\n                var surrounding = this.countSurroundingCellsWithValue(neighbors, 'wasOpen');\n                this.open = (this.wasOpen && surrounding >= 4) || surrounding >= 6;\n            },\n            reset: function () {\n                this.wasOpen = this.open;\n            }\n        }, function () {\n            //init\n            this.open = Math.random() > 0.40;\n        });\n\n        world.initialize([\n            { name: 'wall', distribution: 100 }\n        ]);\n\n        // generate our cave, 10 steps aught to do it\n        for (var i=0; i<10; i++) {\n            world.step();\n        }\n\n        var grid = world.createGridFromValues([\n            { cellType: 'wall', hasProperty: 'open', value: 0 }\n        ], 1);\n\n        // NOW USE OUR CAVES TO CREATE A NEW WORLD CONTAINING WATER\n        world = new CellAuto.World({\n            width: width,\n            height: height,\n            clearRect: true\n        });\n\n        world.palette = [\n            [89, 125, 206, 0 * 255],\n            [89, 125, 206, 1/9 * 255],\n            [89, 125, 206, 2/9 * 255],\n            [89, 125, 206, 3/9 * 255],\n            [89, 125, 206, 4/9 * 255],\n            [89, 125, 206, 5/9 * 255],\n            [89, 125, 206, 6/9 * 255],\n            [89, 125, 206, 7/9 * 255],\n            [89, 125, 206, 8/9 * 255],\n            [89, 125, 206, 1 * 255],\n            [109, 170, 44, 1 * 255],\n            [68, 36, 52, 1 * 255]\n        ];\n\n        world.registerCellType('water', {\n            getColor: function() {\n                //return 0x597DCE44;\n                return this.water;\n            },\n            process: function(neighbors) {\n                if (this.water === 0) {\n                    // already empty\n                    return;\n                }\n                // push my water out to my available neighbors\n\n                // cell below me will take all it can\n                if (neighbors[world.BOTTOM.index] !== null && this.water && neighbors[world.BOTTOM.index].water < 9) {\n                    var amt = Math.min(this.water, 9 - neighbors[world.BOTTOM.index].water);\n                    this.water-= amt;\n                    neighbors[world.BOTTOM.index].water += amt;\n                    return;\n                }\n\n                // bottom two corners take half of what I have\n                for (var i=5; i<=7; i++) {\n                    if (i!=world.BOTTOM.index && neighbors[i] !== null && this.water && neighbors[i].water < 9) {\n                        var amt = Math.min(this.water, Math.ceil((9 - neighbors[i].water)/2));\n                        this.water-= amt;\n                        neighbors[i].water += amt;\n                        return;\n                    }\n                }\n                // sides take a third of what I have\n                for (i=3; i<=4; i++) {\n                    if (neighbors[i] !== null && neighbors[i].water < this.water) {\n                        var amt = Math.min(this.water, Math.ceil((9 - neighbors[i].water)/3));\n                        this.water-= amt;\n                        neighbors[i].water += amt;\n                        return;\n                    }\n                }\n            }\n        }, function() {\n            //init\n            this.water = Math.floor(Math.random() * 9);\n        });\n\n        world.registerCellType('rock', {\n            isSolid: true,\n            getColor: function() {\n                return this.lighted ? 10 : 11;\n            },\n            process: function(neighbors) {\n                this.lighted = neighbors[world.TOP.index] && !(neighbors[world.TOP.index].water === 9) && !neighbors[world.TOP.index].isSolid\n                    && neighbors[world.BOTTOM.index] && neighbors[world.BOTTOM.index].isSolid;\n            }\n        });\n\n        // pass in our generated cave data\n        world.initializeFromGrid([\n            { name: 'rock', gridValue: 1 },\n            { name: 'water', gridValue: 0 }\n        ], grid);\n\n        return world;\n    },\n\n    Rain: function(width = 128, height = 128) {\n        // FIRST CREATE CAVES\n        var world = new CellAuto.World({\n            width: width,\n            height: height\n        });\n\n        world.registerCellType('wall', {\n            process: function (neighbors) {\n                var surrounding = this.countSurroundingCellsWithValue(neighbors, 'wasOpen');\n                this.open = (this.wasOpen && surrounding >= 4) || surrounding >= 6;\n            },\n            reset: function () {\n                this.wasOpen = this.open;\n            }\n        }, function () {\n            //init\n            this.open = Math.random() > 0.40;\n        });\n\n        world.initialize([\n            { name: 'wall', distribution: 100 }\n        ]);\n\n        // generate our cave, 10 steps aught to do it\n        for (var i=0; i<10; i++) {\n            world.step();\n        }\n\n        var grid = world.createGridFromValues([\n            { cellType: 'wall', hasProperty: 'open', value: 0 }\n        ], 1);\n\n        // cut the top half of the caves off\n        for (var y=0; y<Math.floor(world.height/2); y++) {\n            for (var x=0; x<world.width; x++) {\n                grid[y][x] = 0;\n            }\n        }\n\n        // NOW USE OUR CAVES TO CREATE A NEW WORLD CONTAINING WATER\n        world = new CellAuto.World({\n            width: width,\n            height: height,\n            clearRect: true\n        });\n\n        world.palette = [\n            [89, 125, 206, 1],\n            [89, 125, 206, 1/9 * 255],\n            [89, 125, 206, 2/9 * 255],\n            [89, 125, 206, 3/9 * 255],\n            [89, 125, 206, 4/9 * 255],\n            [89, 125, 206, 5/9 * 255],\n            [89, 125, 206, 6/9 * 255],\n            [89, 125, 206, 7/9 * 255],\n            [89, 125, 206, 8/9 * 255],\n            [89, 125, 206, 255],\n            [109, 170, 44, 255],\n            [68, 36, 52, 255]\n        ];\n\n        world.registerCellType('air', {\n            getColor: function() {\n                //return '89, 125, 206, ' + (this.water ? Math.max(0.3, this.water/9) : 0);\n                return this.water;\n            },\n            process: function(neighbors) {\n                // rain on the top row\n                if (neighbors[world.TOP.index] === null && Math.random() < 0.02) {\n                    this.water = 5;\n                }\n                else if (this.water === 0) {\n                    // already empty\n                    return;\n                }\n\n                // push my water out to my available neighbors\n\n                // cell below me will take all it can\n                if (neighbors[world.BOTTOM.index] !== null && this.water && neighbors[world.BOTTOM.index].water < 9) {\n                    var amt = Math.min(this.water, 9 - neighbors[world.BOTTOM.index].water);\n                    this.water-= amt;\n                    neighbors[world.BOTTOM.index].water += amt;\n                    return;\n                }\n\n                // bottom two corners take half of what I have\n                for (var i=5; i<=7; i++) {\n                    if (i!=world.BOTTOM.index && neighbors[i] !== null && this.water && neighbors[i].water < 9) {\n                        var amt = Math.min(this.water, Math.ceil((9 - neighbors[i].water)/2));\n                        this.water-= amt;\n                        neighbors[i].water += amt;\n                        return;\n                    }\n                }\n                // sides take a third of what I have\n                for (i=3; i<=4; i++) {\n                    if (neighbors[i] !== null && neighbors[i].water < this.water) {\n                        var amt = Math.min(this.water, Math.ceil((9 - neighbors[i].water)/3));\n                        this.water-= amt;\n                        neighbors[i].water += amt;\n                        return;\n                    }\n                }\n            }\n        }, function() {\n            //init\n            this.water = 0;\n        });\n\n        world.registerCellType('rock', {\n            isSolid: true,\n            getColor: function() {\n                return this.lighted ? 10 : 11;\n            },\n            process: function(neighbors) {\n                this.lighted = neighbors[world.TOP.index] && !(neighbors[world.TOP.index].water === 9) && !neighbors[world.TOP.index].isSolid\n                    && neighbors[world.BOTTOM.index] && neighbors[world.BOTTOM.index].isSolid;\n            }\n        });\n\n        // pass in our generated cave data\n        world.initializeFromGrid([\n            { name: 'rock', gridValue: 1 },\n            { name: 'air', gridValue: 0 }\n        ], grid);\n\n        return world;\n    },\n\n    /**\n     * Simulates splashing water.\n     * \n     * From https://sanojian.github.io/cellauto\n     */\n    Splashes: function(width = 128, height = 128) {\n        var world = new CellAuto.World({\n            width: width,\n            height: height\n        });\n\n        world.palette = [];\n        var colors = [];\n        for (var index=0; index<64; index++) {\n            world.palette.push([89, 125, 206, (index/64) * 255]);\n            colors[index] = 63 - index;\n        }\n\n        world.registerCellType('water', {\n            getColor: function () {\n                var v = (Math.max(2 * this.value + 0.02, 0) - 0.02) + 0.5;\n                return colors[Math.floor(colors.length * v)];\n            },\n            process: function (neighbors) {\n                if(this.droplet == true) {\n                    for (var i = 0; i < neighbors.length; i++) {\n                        if (neighbors[i] !== null && neighbors[i].value) {\n                            neighbors[i].value = 0.5 *this.value;\n                            neighbors[i].prev = 0.5 *this.prev;\n                        }\n                    }\n                    this.droplet = false;\n                    return true;\n                }\n                var avg = this.getSurroundingCellsAverageValue(neighbors, 'value');\n                this.next = 0.99 * (2 * avg - this.prev);\n                return true;\n            },\n            reset: function () {\n                if(Math.random() > 0.9999) {\n                    this.value = -0.2 + 0.25*Math.random();\n                    this.prev = this.value;\n                    this.droplet = true;\n                }\n                else {\n                    this.prev = this.value;\n                    this.value = this.next;\n                }\n                return true;\n            }\n        }, function () {\n            //init\n            this.water = true;\n            this.value = 0.0;\n            this.prev = this.value;\n            this.next = this.value;\n        });\n\n        world.initialize([\n            { name: 'water', distribution: 100 }\n        ]);\n\n        return world;\n    },\n\n    /**\n     * Rule 52928 - the CA used for Wolfram Alpha's loading animations\n     * \n     * Resources:\n     * https://www.quora.com/What-is-Wolfram-Alphas-loading-screen-a-depiction-of\n     * http://jsfiddle.net/hungrycamel/9UrzJ/\n     */\n    Wolfram: function(width = 96, height = 96) {\n        var world = new CellAuto.World({\n            width: width,\n            height: height,\n            wrap: true\n        });\n\n        world.recommendedFrameFrequency = 2;\n\n        world.palette = [\n            [255, 255, 255, 255], // Background color\n            [255, 110, 0  , 255], // dark orange\n            [255, 130, 0  , 255], //      |\n            [255, 150, 0  , 255], //      |\n            [255, 170, 0  , 255], //      V\n            [255, 180, 0  , 255]  // light orange\n        ];\n\n        var choice = Math.random();\n\n        var seedList = [\n            [\n                [0, 0, 0, 1, 0, 0, 0, 0, 0, 0], \n                [0, 2, 1, 1, 1, 1, 0, 0, 0, 0], \n                [1, 1, 3, 4, 2, 1, 1, 0, 0, 0], \n                [0, 1, 1, 1, 4, 1, 1, 0, 0, 0], \n                [0, 1, 2, 0, 1, 1, 1, 1, 0, 0], \n                [0, 1, 1, 1, 0, 0, 2, 2, 0, 0], \n                [0, 0, 2, 2, 0, 0, 1, 1, 1, 0], \n                [0, 0, 1, 1, 1, 1, 0, 2, 1, 0], \n                [0, 0, 0, 1, 1, 4, 1, 1, 1, 0], \n                [0, 0, 0, 1, 1, 2, 4, 3, 1, 1], \n                [0, 0, 0, 0, 1, 1, 1, 1, 2, 0], \n                [0, 0, 0, 0, 0, 0, 1, 0, 0, 0]\n            ], \n            [[0, 0, 0, 0, 0, 0, 1, 0], [1, 1, 1, 1, 0, 0, 1, 0], [0, 1, 0, 0, 1, 1, 1, 1], [0, 1, 0, 0, 0, 0, 0, 0]], \n            [[0, 0, 0, 0, 0, 0, 1, 1], [0, 0, 1, 1, 1, 0, 1, 1], [1, 1, 0, 1, 1, 1, 0, 0], [1, 1, 0, 0, 0, 0, 0, 0]], \n            [[0, 0, 0, 0, 0, 0, 1, 1], [0, 1, 1, 1, 1, 1, 0, 0], [0, 0, 1, 1, 1, 1, 1, 0], [1, 1, 0, 0, 0, 0, 0, 0]], \n            [[0, 0, 0, 0, 0, 0, 1, 1], [1, 0, 0, 0, 1, 1, 1, 0], [0, 1, 1, 1, 0, 0, 0, 1], [1, 1, 0, 0, 0, 0, 0, 0]], \n            [[0, 0, 0, 0, 0, 0, 1, 1], [1, 0, 0, 1, 1, 0, 1, 1], [1, 1, 0, 1, 1, 0, 0, 1], [1, 1, 0, 0, 0, 0, 0, 0]], \n            [[0, 0, 0, 0, 1, 1, 1, 0], [1, 1, 1, 0, 1, 1, 1, 1], [1, 1, 1, 1, 0, 1, 1, 1], [0, 1, 1, 1, 0, 0, 0, 0]], \n            [[0, 0, 1, 1, 1, 1, 1, 1], [1, 0, 1, 1, 0, 1, 1, 1], [1, 1, 1, 0, 1, 1, 0, 1], [1, 1, 1, 1, 1, 1, 0, 0]], \n            [[0, 1, 0, 0, 0, 1, 1, 1], [1, 0, 1, 1, 0, 1, 1, 1], [1, 1, 1, 0, 1, 1, 0, 1], [1, 1, 1, 0, 0, 0, 1, 0]], \n            [[0, 1, 1, 0, 1, 1, 1, 1], [0, 1, 0, 1, 0, 0, 1, 0], [0, 1, 0, 0, 1, 0, 1, 0], [1, 1, 1, 1, 0, 1, 1, 0]], \n            [[1, 1, 1, 0, 1, 1, 1, 0], [0, 1, 0, 0, 1, 1, 1, 0], [0, 1, 1, 1, 0, 0, 1, 0], [0, 1, 1, 1, 0, 1, 1, 1]], \n            [[1, 1, 1, 0, 1, 1, 1, 1], [1, 1, 0, 1, 1, 1, 1, 0], [0, 1, 1, 1, 1, 0, 1, 1], [1, 1, 1, 1, 0, 1, 1, 1]], \n            [[1, 1, 1, 1, 0, 0, 0, 1], [1, 1, 0, 1, 1, 0, 0, 1], [1, 0, 0, 1, 1, 0, 1, 1], [1, 0, 0, 0, 1, 1, 1, 1]], \n            [[1, 1, 1, 1, 0, 0, 1, 0], [0, 0, 1, 0, 1, 1, 0, 1], [1, 0, 1, 1, 0, 1, 0, 0], [0, 1, 0, 0, 1, 1, 1, 1]], \n            [[1, 1, 1, 1, 0, 0, 1, 0], [1, 0, 0, 1, 1, 0, 1, 1], [1, 1, 0, 1, 1, 0, 0, 1], [0, 1, 0, 0, 1, 1, 1, 1]], \n            [[1, 1, 1, 1, 0, 0, 1, 0], [1, 1, 1, 0, 1, 0, 0, 1], [1, 0, 0, 1, 0, 1, 1, 1], [0, 1, 0, 0, 1, 1, 1, 1]], \n            [[1, 1, 1, 1, 0, 0, 1, 0], [1, 1, 1, 0, 1, 1, 0, 1], [1, 0, 1, 1, 0, 1, 1, 1], [0, 1, 0, 0, 1, 1, 1, 1]], \n            [[1, 1, 1, 1, 0, 0, 1, 0], [1, 1, 1, 1, 0, 0, 1, 1], [1, 1, 0, 0, 1, 1, 1, 1], [0, 1, 0, 0, 1, 1, 1, 1]], \n            [[1, 1, 1, 1, 0, 1, 0, 1], [1, 1, 1, 0, 0, 1, 0, 0], [0, 0, 1, 0, 0, 1, 1, 1], [1, 0, 1, 0, 1, 1, 1, 1]], \n            [[1, 1, 1, 1, 0, 1, 1, 0], [0, 0, 0, 0, 0, 1, 1, 0], [0, 1, 1, 0, 0, 0, 0, 0], [0, 1, 1, 0, 1, 1, 1, 1]], \n            [[1, 1, 1, 1, 0, 1, 1, 0], [0, 1, 0, 0, 1, 0, 1, 0], [0, 1, 0, 1, 0, 0, 1, 0], [0, 1, 1, 0, 1, 1, 1, 1]], \n            [[1, 1, 1, 1, 0, 1, 1, 0], [1, 1, 1, 0, 0, 1, 1, 0], [0, 1, 1, 0, 0, 1, 1, 1], [0, 1, 1, 0, 1, 1, 1, 1]], \n            [[1, 1, 1, 1, 1, 0, 0, 0], [0, 0, 1, 1, 1, 1, 0, 0], [0, 0, 1, 1, 1, 1, 0, 0], [0, 0, 0, 1, 1, 1, 1, 1]], \n            [[1, 1, 1, 1, 1, 0, 0, 0], [1, 1, 0, 1, 1, 1, 1, 0], [0, 1, 1, 1, 1, 0, 1, 1], [0, 0, 0, 1, 1, 1, 1, 1]], \n            [[1, 1, 1, 1, 1, 0, 1, 1], [0, 0, 1, 1, 1, 0, 0, 0], [0, 0, 0, 1, 1, 1, 0, 0], [1, 1, 0, 1, 1, 1, 1, 1]], \n            [[1, 1, 1, 1, 1, 0, 1, 1], [0, 1, 1, 1, 1, 1, 0, 1], [1, 0, 1, 1, 1, 1, 1, 0], [1, 1, 0, 1, 1, 1, 1, 1]], \n            [[1, 1, 1, 1, 1, 0, 1, 1], [1, 1, 0, 1, 0, 1, 1, 0], [0, 1, 1, 0, 1, 0, 1, 1], [1, 1, 0, 1, 1, 1, 1, 1]], \n            [[1, 1, 1, 1, 1, 0, 1, 1], [1, 1, 1, 1, 0, 0, 1, 1], [1, 1, 0, 0, 1, 1, 1, 1], [1, 1, 0, 1, 1, 1, 1, 1]], \n            [[1, 1, 1, 1, 1, 1, 0, 0], [0, 0, 1, 0, 0, 1, 1, 1], [1, 1, 1, 0, 0, 1, 0, 0], [0, 0, 1, 1, 1, 1, 1, 1]], \n            [[1, 1, 1, 1, 1, 1, 0, 0], [0, 1, 1, 1, 1, 1, 1, 0], [0, 1, 1, 1, 1, 1, 1, 0], [0, 0, 1, 1, 1, 1, 1, 1]], \n            [[1, 1, 1, 1, 1, 1, 1, 0], [0, 0, 1, 0, 1, 0, 1, 1], [1, 1, 0, 1, 0, 1, 0, 0], [0, 1, 1, 1, 1, 1, 1, 1]]\n        ];\n\n        world.registerCellType('living', {\n            getColor: function () {\n                return this.state;\n            },\n            process: function (neighbors) {\n\n                var neighborOnes = neighbors.filter(function(item){\n                    return item.state == 1;\n                }).length;\n\n                if(this.state == 0) {\n                    if(neighborOnes == 3 || neighborOnes == 5 || neighborOnes == 7) \n                        this.newState = 1;\n                } else if (this.state == 1) {\n                    if(neighborOnes == 0 || neighborOnes == 1 || neighborOnes == 2 || neighborOnes == 6 || neighborOnes == 8)\n                        this.newState = 2;\n                } else if (this.state == 2) {\n                    this.newState = 3;\n                } else if (this.state == 3) {\n                    this.newState = 4;\n                } else if (this.state == 4) {\n                    this.newState = 0;\n                }\n            },\n            reset: function () {\n                this.state = this.newState;\n            }\n        }, function (x, y) {\n            // Init \n\n            // 50% chance to use a seed\n            if(choice < 0.5){\n                var seed;\n                // 25% chance to use a random seed\n                if(choice < 0.25) {\n                    seed = seedList[Math.floor(Math.random() * seedList.length)];\n                }\n                // 25% chance to use the Wolfram seed\n                else {\n                    seed = seedList[0];\n                }\n\n                var minX = Math.floor(width / 2) - Math.floor(seed[0].length / 2);\n                var maxX = Math.floor(width / 2) + Math.floor(seed[0].length / 2);\n                var minY = Math.floor(height / 2) - Math.floor(seed.length / 2);\n                var maxY = Math.floor(height / 2) + Math.floor(seed.length / 2);\n\n                this.state = 0;\n\n                // If the cell is inside of the seed array (centered in the world), then use its value\n                if (x >= minX && x < maxX && y >= minY && y < maxY) {\n                    this.state = seed[y - minY][x - minX];\n                }\n            } \n            // 50% chance to initialize with noise\n            else {\n                this.state = Math.random() < 0.15 ? 1 : 0;\n            }\n            this.newState = this.state;\n        });\n\n        world.initialize([\n           { name: 'living', distribution: 100 },\n        ]);\n\n        return world;\n    },\n\n    /**\n     * Simulates a Belousov-Zhabotinsky reaction (approximately).\n     * This one's still a little messed up, so consider it experimental.\n     * \n     * Resources:\n     * http://ccl.northwestern.edu/netlogo/models/B-ZReaction\n     * http://www.fractaldesign.net/automataalgorithm.aspx\n     */\n    BelousovZhabotinsky: function(width = 128, height = 128) {\n        var world = new CellAuto.World({\n            width: width,\n            height: height,\n            wrap: true\n        });\n\n        // Override frame frequency for this setup\n        world.recommendedFrameFrequency = 10;\n\n        // Config variables\n        var kernel = [ // weights for neighbors. First index is for self weight\n         0, 1, 1, 1,\n            1,    1,\n            1, 1, 1\n        ].reverse();\n        var k1 = 5; // Lower gives higher tendency for a cell to be sickened by ill neighbors\n        var k2 = 1; // Lower gives higher tendency for a cell to be sickened by infected neighbors\n        var g = 5;\n        var numStates = 255;\n\n        world.palette = [];\n        for (var i = 0; i < numStates; i++) {\n            var gray = Math.floor((255 / numStates) * i);\n            world.palette.push([gray, gray, gray, 255]);\n        }\n\n        world.registerCellType('bz', {\n            getColor: function () {\n                return this.state;\n            },\n            process: function (neighbors) {\n                var healthy = 0;\n                var infected = 0;\n                var ill = 0;\n                var sumStates = this.state;\n    \n                for(var i = 0; i < neighbors.length + 1; i++) {\n                    var neighbor;\n                    if (i == 8) neighbor = this;\n                    else neighbor = neighbors[i];\n                    \n                    //if(neighbor !== null && neighbor.state){\n                        sumStates += neighbor.state * kernel[i];\n                        if(kernel[i] > 0) {\n                            if(neighbor.state == 0) healthy += 1;\n                            else if(neighbor.state < (numStates - 1)) infected += 1;\n                            else ill += 1;\n                        }\n                    //}\n                }\n\n                if(this.state == 0) {\n                    this.newState = (infected / k1) + (ill / k2);\n                } else if (this.state < (numStates) - 1) {\n                    this.newState = (sumStates / infected + ill + 1) + g;\n                    //this.newState = (sumStates / 9) + g;\n                } else {\n                    this.newState = 0;\n                }\n\n                // Make sure to set state to newstate in a second pass\n                this.newState = Math.max(0, Math.min(numStates - 1, Math.floor(this.newState)));\n\n            },\n            reset: function () {\n                this.state = this.newState;\n            }\n        }, function () {\n            // Init\n            // Generate a random state\n            this.state = Math.random() < 1.0 ? Math.floor(Math.random() * numStates) : 0;\n            this.newState = this.state;\n        });\n\n        world.initialize([\n            { name: 'bz', distribution: 100 }\n        ]);\n\n        return world;\n    }\n\n}"]}